<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8"/>
    <script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>

    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
            crossorigin="anonymous"
    />
    <link
            href="https://font.elice.io/css?family=Elice+DX+Neolli"
            rel="stylesheet"
    />
    <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"
    />

    <style>
        .image-preview {
            max-width: 55%;
            max-height: 55%;
        }

        .comment-list-container td {
            /* 단어 단위로 줄바꿈 */
            word-wrap: break-word;
        }
        #commentWriter {
            width: 15%; /* 입력 필드의 가로 길이를 50%로 지정 */
        }
        #commentContents{
            width: 30%;
        }
        label{
            padding-top: 5px;
            padding-bottom: 5px;
        }
        html,
        body {
            font-family: "Elice DX Neolli", sans-serif;
        }

        .dropdown-toggle:after {
            content: none;
        }

        .comment .btn-group {
            display: none;
        }

        .comment:hover .btn-group {
            display: flex;
        }

        td {
            padding-left: 20px;
        }

        button {
            margin-bottom: 30px;
        }

    </style>
    <title>게시글</title>
</head>
<body>
<div class="container my-5 mx-auto">
    <button class="btn btn-success" onclick="listReq()"
    >&larr; 게시판으로 돌아가기
    </button
    >
    <div class="container border rounded p-4 position-relative">
        <div class="header mb-3">
            <h2 class="text-start" th:text="${board.boardTitle}">게시글 제목</h2>
        </div>
        <table>
            <tr>
                <th>닉네임</th>
                <td th:text="${board.boardWriter}"></td>
            </tr>
            <tr>
                <th>작성일자</th>
                <td th:text="${#temporals.format(board.boardCreatedTime, 'yyyy-MM-dd')}"></td>
            </tr>

            <tr>
                <th>조회수</th>
                <td th:text="${board.boardHits}"></td>
            </tr>
        </table>
        <hr class="mt-4"/>

        <div class="mb-3">
        <label for="content" class="form-label"><strong>게시글 내용</strong></label><br>

        <!-- 파일 첨부된 경우 이미지 표시 -->
        <table th:if="${board.fileAttached == 1}">
            <tr>
                <td th:each="fileName: ${board.storedFileName}">
                    <img th:src="@{|/upload/${fileName}|}" alt="" class="image-preview">
                </td>
            </tr>
        </table>
        <br>
        <!-- 게시글 내용 텍스트 영역 -->
        <textarea class="form-control" id="content" name="boardContents" cols="30" rows="10" readonly th:text="${board.boardContents}"></textarea>
    </div>

    <hr class="mt-4"/>
        <h4 class="mb-3">
            댓글
            <small
                    class="text-secondary"
                    id="commentsCount"
                    th:text="${#lists.size(commentList)}"
            ></small
            >
        </h4>

        <div id="comment-write" class="comment-form-container">

            <div class="form-group">
                <label for="commentWriter"> 작성자</label>
                <input type="text" id="commentWriter" class="form-control" placeholder="(최대10글자)" maxlength="10">
            </div>
            <div class="form-group">
                <label for="commentContents"> 내용</label>
                <textarea id="commentContents" class="form-control" placeholder="내용"></textarea>
            </div>
            <button id="comment-writer-btn" class="btn btn-success" onclick="commentWrite()" style="margin-top: 15px">입력</button>
        </div>
        <!-- 댓글 출력 부분-->

        <div id="comment-list" class="comment-list-container">
            <table class="table">
                <thead>
                <tr>
                    <th scope="col">작성자</th>
                    <th scope="col">내용</th>
                    <th scope="col">작성시간</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="comment: ${commentList}">
                    <td th:text="${comment.commentWriter}"></td>
                    <td th:text="${comment.commentContents}"></td>
                    <td th:text="${#temporals.format(comment.commentCreatedTime, 'yyyy-MM-dd')}"></td>
                </tr>
                </tbody>
            </table>
        </div>

    </div>
</div>



<!-- 부트스트랩 JS 추가 -->
<script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"
></script>
<script>

    const commentWrite = () => {
        const writer = document.getElementById("commentWriter").value;
        const contents = document.getElementById("commentContents").value;
        console.log("작성자: ", writer);
        console.log("내용: ", contents);

        // 댓글 내용이 비어 있는지 확인
        if (!contents.trim()) {
            alert("댓글 내용을 입력해주세요.");
            return; // 댓글 내용이 비어 있으면 제출을 중단
        }

        const id = [[${board.id}]];

        $.ajax({
            type: "post",
            url: "/comment/save",
            data: {
                "commentWriter": writer,
                "commentContents": contents,
                "boardId": id
            },
            success: function (res) {
                console.log("요청성공", res);
                let output = "<table class='table'>"; // 테이블 클래스 추가
                output += "<thead><tr><th scope='col'>작성자</th><th scope='col'>내용</th><th scope='col'>작성시간</th></tr></thead>";
                output += "<tbody>";
                for (let i in res) {
                    output += "<tr>";
                    output += "<td>" + res[i].commentWriter + "</td>";
                    output += "<td>" + res[i].commentContents + "</td>";
                    output += "<td>" + moment(res[i].commentCreatedTime).format('YYYY-MM-DD') + "</td>";
                    output += "</tr>";
                }
                output += "</tbody>";
                output += "</table>";
                $('#comment-list').html(output);
                $('#commentWriter').val('');
                $('#commentContents').val('');
                $('#commentsCount').text(res.length);
            },
            error: function (err) {
                console.log("요청실패", err);
            }
        });



    }


    const listReq = () => {
        location.href = "/board/paging";
    }
</script>
</body>
</html>
